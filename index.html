<!DOCTYPE html>

<!-- CS 520 Sentinel graphical interface -->
<!-- Alyssa Seifert, Omar Ismail, Stephen Palagi, Josh Tranfaglia -->

<html lang="en">
	
	<!-- HEAD -->
	<head>
		<title> CS 520 Sentinel</title>
		<!-- libraries and stylesheets -->
		<!-- boostrap, jqeury, custom css -->
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
  		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  		<link rel="stylesheet" type="text/css" href="sentinel.css">
  		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
	  	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
	  	<script src="PapaParse-4.1.2/papaparse.min.js"></script>
	</head>
	<!-- END HEAD -->

	<!-- BODY -->
	<body>
		<!-- NAVBAR -->
		<nav class="navbar navbar-default">
			<div class="container-fluid">
				<div class="navbar-header">
					<a class="navbar-brand" href="#">CS 520 Sentinel</a>
				</div>
				<ul class="nav navbar-nav" id="filter-text">
					<li class="active"><a href="#">Mutants</a></li>
					<li class="dropdown">
						<a class="dropdown-toggle" data-toggle="dropdown" href="#"><span id="filter-one"></span><span class="caret"></span></a>
						<ul class="dropdown-menu">
							<li><a href="#" onclick="shuffle(twoFilter)"><span id="filter-two"></span></a></li>
							<li><a href="#" onclick="shuffle(threeFilter)"><span id="filter-three"></span></a></li>
						</ul>
					</li>
				</ul>
			</div>
		</nav>
		<!-- END NAVBAR -->

		<!-- INTERFACE -->
		<div class="container-fluid">
			<div class="row">
				<div class="col-md-12">
					<div class="well well-sm">
						<table class="table table-condensed borderless">
							<thead>
								<input type="file" id="csv-input" onchange="parsecsv()"></input><br>
								<th>Summary</th>
							</thead>
							<tbody>
								<tr><td>Mutants Generated: <span id="tm"></span></td></tr>
								<tr><td>Mutants Killed: <span id="tk"></span></td></tr>
								<tr><td>Mutants Living: <span id="tl"></span></td></tr>
								<tr><td>Run-time (seconds): <span id="rt"></span></td></tr>
							</tbody>
						</table>
					</div>
					<ul class="list-group mutant-bg" id="display-list">
						<li class="list-group-item" id="filler">No file selected!</li>
						
						<!--
						<li class="list-group-item"><span class="glyphicon glyphicon-chevron-right mutant-glyph"></span>Mutant 2 // <span style="color:#990000">KILLED</span></li>
						<li class="list-group-item"><span class="glyphicon glyphicon-chevron-down mutant-glyph"></span>Mutant 1 // <span style="color:#006600">LIVE</span>
						<br><br>
								<p>
									Source: C:/usr/tmp/bin/module.java<br>
									Line(s) Changed: 18<br><br>
									SOURCE:<br>
									<code style="color:black">if (a <= <span style="color:red">0</span> || b <= 0 || c <= 0) {</code><br><br>
									MUTANT:<br>
									<code style="color:black">if (a <= <span style="color:red">1</span> || b <= 0 || c <= 0) {</code>
								</p>
						</li>
						<li class="list-group-item"><span class="glyphicon glyphicon-chevron-right mutant-glyph"></span>Mutant 2 // <span style="color:#990000">KILLED</span></li>
						<li class="list-group-item"><span class="glyphicon glyphicon-chevron-right mutant-glyph"></span>Mutant 2 // <span style="color:#990000">KILLED</span></li>
						<li class="list-group-item"><span class="glyphicon glyphicon-chevron-right mutant-glyph"></span>Mutant 2 // <span style="color:#006600">LIVE</span></li>
						-->
					</ul>
				</div>
			</div>
		</div>
		<!-- END INTERFACE -->

		<!-- JAVASCRIPT -->
		<script>
		filters = ["All", "Live", "Killed"];
		currFilter = filters[0], twoFilter = filters[1], threeFilter = filters[2];

		document.getElementById("filter-one").innerHTML= currFilter;
		document.getElementById("filter-two").innerHTML = twoFilter;
		document.getElementById("filter-three").innerHTML = threeFilter;

		total_mutants = 0;
		total_killed = 0;
		total_live = 0;
		run_time = 0;

		document.getElementById("tm").innerHTML= total_mutants;
		document.getElementById("tk").innerHTML= total_killed;
		document.getElementById("tl").innerHTML= total_live;
		document.getElementById("rt").innerHTML= run_time;
 
		function shuffle(selected) {
			currFilter = selected;
			if (selected === filters[0]) {
				twoFilter = filters[1];
				threeFilter = filters[2];
			} else if (selected == filters[1]) {
				twoFilter = filters[0];
				threeFilter = filters[2];
			} else {
				twoFilter = filters[0];
				threeFilter = filters[1];
			}
			document.getElementById("filter-one").innerHTML= currFilter;
			document.getElementById("filter-two").innerHTML = twoFilter;
			document.getElementById("filter-three").innerHTML = threeFilter;
			return;
		}

		function display_mutants(results) {
			var list = document.getElementById("display-list");
			var list_filler = document.getElementById("filler");
			list.removeChild(list_filler);

			var li;

			for (var i = 0; i < results.data.length; i++) {
			}	
		}

		function getstats(results) {
			for (var i = 0; i < results.data.length; i++) {
				if (results.data[i][1] == "LIVE") {
					total_live++;
					total_mutants++;
				} else if (results.data[i][1] == "FAIL") {
					total_killed++;
					total_mutants++;
				}
			}
			document.getElementById("tm").innerHTML= total_mutants;
			document.getElementById("tk").innerHTML= total_killed;
			document.getElementById("tl").innerHTML= total_live;

			display_mutants(results);
		}

		function parsecsv() {

			// reset stats if new file is chosen
			total_mutants = 0;
			total_killed = 0;
			total_live = 0;
			run_time = 0;

			var file = document.getElementById("csv-input");

			if ('files' in file) {
				if (file.files.length == 0) {
					console.log("select a csv file");
				} else {
					Papa.parse(file.files[0], {
						complete: function(results) {
							console.log("Finished:", results);	
							getstats(results);
						} 
					});
				}
			}
		}

		// creates 2D array of mutant data from CSV file
		/*function processData(allText) {
			var allTextLines = allText.split(/\r\n|\n/);
			var headers = allTextLines[0].split(',',3);
			var lines = [];

			for (var i=1; i<allTextLines.length; i++) {
				//split at first 2 commas then first 2 "@@"
			    var data = allTextLines[i].split(',',3).split("@@",3); 
			    if (data.length == headers.length+2) { //==5
			        lines.push(data);
			    }
			}
			return lines;
		}

		//takes 2D array and makes it into an html unordered list of mutant string data
		function populateMutantList(lines){
			var mutantsList = document.createElement('ul');
				mutantsList.class = "list-group mutant-bg"
		    for(var i = 0; i < lines.length; i++) {
		        // Create the list item:
		      //  var mutantLiElem = document.createElement('li');
		        	var mutant = document.createElement('ul');
		        	for(var j = 1 ; j<lines.length ; j++){
		        		var mutantLine = lines[j]
		        		var mutantAttribute = document.createElement("li");
		        		mutantAttribute.appendChild(document.createTextNode(mutantLine[j]));
		        		mutantAttribute.class = "list-group-item"
		        		mutant.appendChild(mutantAttribute);
		        	}
		        // Add it to the list:
		        mutantsList.appendChild(mutant);
    		}
    		// Finally, return the constructed list:
    		return mutantList;
		}*/

		</script>
		<!-- END JAVSCRIPT -->
	</body>
	<!-- END BODY -->

</html>	